(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[625],{6986:(e,t,a)=>{"use strict";a.d(t,{Z:()=>u});var n=a(959),i=a(3268),r=a(715),o=a(7114),l=a(9037);const s={container:"container_KHaM",panel:"panel_p8cl",editor:"editor_LjJP",response:"response_Ger1",tool:"tool_nUFu",notool:"notool_i7V8"},p=e=>{e.getWrapperElement().closest(".graphiql-editor").style.height=`${e.doc.height}px`};function d(e){const{queryEditor:t,variableEditor:a,headerEditor:i}=(0,l._i)({nonNull:!0}),[r,o]=(0,n.useState)(e.defaultTab),d=(0,l.Xd)({onCopyQuery:e.onCopyQuery}),m=(0,l.fE)();return(0,n.useEffect)((()=>{a&&p(a)}),[r,a]),(0,n.useEffect)((()=>{i&&p(i)}),[r,i]),(0,n.useEffect)((()=>{t&&(t.setOption("lineNumbers",!1),t.setOption("keyMap",t.getOption("extraKeys")),t.setOption("gutters",[]),t.on("change",p),p(t))}),[t]),(0,n.useEffect)((()=>{a&&(a.setOption("lineNumbers",!1),a.setOption("gutters",[]),a.on("change",p))}),[a]),(0,n.useEffect)((()=>{i&&(i.setOption("lineNumbers",!1),i.setOption("gutters",[]),i.on("change",p))}),[i]),n.createElement("div",{className:"graphiql-editors"},n.createElement("section",{className:"graphiql-query-editor","aria-label":"Query Editor"},n.createElement("div",{className:"graphiql-query-editor-wrapper"},n.createElement(l.WK,{editorTheme:e.editorTheme,keyMap:e.keyMap,onCopyQuery:e.onCopyQuery,onEdit:e.onEditQuery,readOnly:e.readOnly})),n.createElement("div",{className:"graphiql-toolbar",role:"toolbar","aria-label":"Editor Commands"},n.createElement(l._8,null),n.createElement(l.wC,{onClick:()=>m(),label:"Prettify query (Shift-Ctrl-P)"},n.createElement(l.Kt,{className:"graphiql-toolbar-icon","aria-hidden":"true"})),n.createElement(l.wC,{onClick:()=>d(),label:"Copy query (Shift-Ctrl-C)"},n.createElement(l.TI,{className:"graphiql-toolbar-icon","aria-hidden":"true"})))),n.createElement("div",{className:"graphiql-editor-tools"},n.createElement("div",{className:"graphiql-editor-tools-tabs"},n.createElement(l.v0,{type:"button",className:"variables"===r?"active":"",onClick:()=>{o("variables"===r?"":"variables")}},"Variables"),n.createElement(l.v0,{type:"button",className:"headers"===r?"active":"",onClick:()=>{o("headers"===r?"":"headers")}},"Headers"))),n.createElement("section",{className:`graphiql-editor-tool ${r&&r.length>0?s.tool:s.notool}`,"aria-label":"variables"===r?"Variables":"Headers"},n.createElement(l.hF,{editorTheme:e.editorTheme,isHidden:"variables"!==r,keyMap:e.keyMap,onEdit:e.onEditVariables,readOnly:e.readOnly}),n.createElement(l.LA,{editorTheme:e.editorTheme,isHidden:"headers"!==r,keyMap:e.keyMap,onEdit:e.onEditHeaders,readOnly:e.readOnly})))}class m{constructor(){this.map=new Map,this.length=0}getItem(e){return this.map.get(e)}setItem(e,t){this.map.has(e)||(this.length+=1),this.map.set(e,t)}removeItem(e){this.map.has(e)&&(this.length-=1),this.map.delete(e)}clear(){this.length=0,this.map.clear()}}function c(){return(0,l.JB)({nonNull:!0}).isFetching?n.createElement(l.$j,null):null}function u(e){let{typegraph:t,query:a,panel:p=null,headers:u={},variables:h={},tab:y=""}=e;const{siteConfig:{customFields:{tgUrl:g}}}=(0,o.Z)(),f=(0,n.useMemo)((()=>new m),[]);return n.createElement(r.Z,{fallback:n.createElement("div",null,"Loading...")},(()=>{const e=(0,n.useMemo)((()=>(0,i.nq)({url:`${g}/${t}`})),[]);return n.createElement(l.j$,{fetcher:e,defaultQuery:a.loc.source.body.trim(),defaultHeaders:JSON.stringify(u),variables:JSON.stringify(h),storage:f},n.createElement("div",{className:`graphiql-container ${s.container}`},p?n.createElement("div",{className:`graphiql-response ${s.panel}`},p):null,n.createElement("div",{className:`graphiql-session ${s.editor}`},n.createElement(d,{defaultTab:y})),n.createElement("div",{className:`graphiql-response ${s.response}`},n.createElement(c,null),n.createElement(l.iB,null))))}))}},9688:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var n=a(1163),i=a(6986),r=a(9107),o=a(959);function l(e){let{python:t,...a}=e;return o.createElement(i.Z,(0,n.Z)({panel:o.createElement(r.Z,{language:"python"},t)},a))}},2082:(e,t,a)=>{"use strict";a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>m});var n=a(1163),i=(a(959),a(7942)),r=a(9107),o=a(9688);const l={sidebar_position:2},s="Your first typegraph",p={unversionedId:"tutorials/your-first-typegraph/index",id:"tutorials/your-first-typegraph/index",title:"Your first typegraph",description:"Before you jump into coding, a brief introduction. The typegraphs - virtual graphs of types - are the secret sauce of the ecosystem. They establish the foundation for all the abstraction that will be introduced later. Similar to programming languages, they let the developer describe with a type system:",source:"@site/docs/tutorials/your-first-typegraph/index.mdx",sourceDirName:"tutorials/your-first-typegraph",slug:"/tutorials/your-first-typegraph/",permalink:"/docs/tutorials/your-first-typegraph/",draft:!1,editUrl:"https://github.com/metatypedev/metatype/tree/main/website/docs/tutorials/your-first-typegraph/index.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docs",previous:{title:"Getting started",permalink:"/docs/tutorials/getting-started"},next:{title:"Adding more runtimes",permalink:"/docs/tutorials/adding-more-runtimes/"}},d={},m=[{value:"Zooming on the types",id:"zooming-on-the-types",level:2},{value:"The typegraph package",id:"the-typegraph-package",level:2},{value:"The meta CLI",id:"the-meta-cli",level:2}],c={toc:m},u="wrapper";function h(e){let{components:t,...l}=e;return(0,i.kt)(u,(0,n.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"your-first-typegraph"},"Your first typegraph"),(0,i.kt)("p",null,"Before you jump into coding, a brief introduction. The typegraphs - virtual graphs of types - are the secret sauce of the ecosystem. They establish the foundation for all the abstraction that will be introduced later. Similar to programming languages, they let the developer describe with a type system:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"what")," data types exists"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"how")," these data get transformed"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"where")," these data and transformations run"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"who")," can access them")),(0,i.kt)("h2",{id:"zooming-on-the-types"},"Zooming on the types"),(0,i.kt)("p",null,'There is no "object" or "primitive" type, only 4 main categories of types:'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"value types: ",(0,i.kt)("inlineCode",{parentName:"li"},"t.integer()"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"t.string()"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"t.uuid()"),", etc."),(0,i.kt)("li",{parentName:"ul"},"quantifier types: ",(0,i.kt)("inlineCode",{parentName:"li"},"t.optional(\xb7)"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"t.array(\xb7)"),", etc."),(0,i.kt)("li",{parentName:"ul"},"consolidator types: ",(0,i.kt)("inlineCode",{parentName:"li"},"t.struct(\xb7, \xb7)"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"t.union(\xb7, \xb7)"),", etc."),(0,i.kt)("li",{parentName:"ul"},"function types: ",(0,i.kt)("inlineCode",{parentName:"li"},"t.func(\xb7 \u2192 \xb7)"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"t.policy(\xb7 \u2192 \xb7)"),", etc.")),(0,i.kt)("p",null,"You can combine them with each other to describe almost any data type you may need. The typegate enforces the data validation when data flows through it. Some syntactic sugar is available to make the type definition shorter:"),(0,i.kt)(r.Z,{language:"python",mdxType:"CodeBlock"},a(3898)),(0,i.kt)("h2",{id:"the-typegraph-package"},"The typegraph package"),(0,i.kt)("p",null,"The typegraph package is a Python package that allows to describe a full typegraph. It's a thin wrapper around the type system, and provides a few helpers to make the typegraph definition easier. It builds on the type system to provide some more building blocks:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"what")," data types exists \u2192 value, quantifier, consolidator ",(0,i.kt)("strong",{parentName:"li"},"types")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"how")," these data get transformed \u2192 function types and ",(0,i.kt)("strong",{parentName:"li"},"materializers")," that specify the transformation"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"where")," these data and transformations run \u2192 ",(0,i.kt)("strong",{parentName:"li"},"runtimes")," metadata that describe materializers operate"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("em",{parentName:"li"},"who")," can access them \u2192 a special case of function types named ",(0,i.kt)("strong",{parentName:"li"},"policies")," that control accesses")),(0,i.kt)("p",null,"This tutorial will cover these abstractions concept by concept and show how to use them by example."),(0,i.kt)("admonition",{title:"Code sample are interactive",type:"info"},(0,i.kt)("p",{parentName:"admonition"},'You can interact with most of the typegraph in the documentation. Some parts might be voluntary hidden and full source can be found on GitHub. Click on "edit this page" to jump there and look into the parent folder.')),(0,i.kt)("p",null,"A complete typegraph definition may look like the following:"),(0,i.kt)(o.Z,{typegraph:"first-typegraph",python:a(1574),query:a(2521),mdxType:"TGExample"}),(0,i.kt)("p",null,"To start with the chat app design, copy the typegraph into a file named ",(0,i.kt)("inlineCode",{parentName:"p"},"typegraph.py")," next to your ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file."),(0,i.kt)("h2",{id:"the-meta-cli"},"The meta CLI"),(0,i.kt)("p",null,"The meta CLI use a YAML configuration file to source some information and avoid typing the same arguments over and over again. Copy the following into named ",(0,i.kt)("inlineCode",{parentName:"p"},"metatype.yml")," also next to previous files:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'typegates:\n  dev:\n    url: "http://localhost:7890"\n    # default values\n    username: admin\n    password: password\ntypegraphs:\n  python:\n    include: "**/*.py"\n')),(0,i.kt)("p",null,"At this point, you should have everything ready for your first typegraph. Run the following command in your terminal:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ls -1a\n# ./\n# ../\n# .venv/\n# docker-compose.yml\n# metatype.yml\n# typegraph.py\n\nmeta dev\n# Loaded 1 typegraph from ./typegraph.py:\n#  \u2192 Pushing typegraph first-typegraph...\n#  \u2713 Success!\n")),(0,i.kt)("p",null,"You can now open ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:7890/first-typegraph"},"http://localhost:7890/first-typegraph")," in your browser. The CLI will automatically watch for changes in the typegraph and reload the typegraph. You should see a GraphQL playground with a query editor and some auto-generated documentation clicking the top-left menu item. ",(0,i.kt)("strong",{parentName:"p"},"Congrats"),", you can now to play with your first typegraph!"),(0,i.kt)("div",{className:"text-center"},(0,i.kt)("img",{src:a(6513).Z,width:"600",alt:"typegate playground"})))}h.isMDXComponent=!0},2521:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"get_message"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]}]}},{kind:"Field",alias:{kind:"Name",value:"second_one"},name:{kind:"Name",value:"get_message"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user_id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:106}};t.loc.source={body:"query {\n  get_message {\n    id\n    title\n    # user_id\n  }\n\n  second_one: get_message {\n    user_id\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var n={};t.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),n[e.name.value]=t}})),e.exports=t},6513:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});const n=a.p+"assets/images/playground-e2945136e370af514015f00940316a79.png"},1574:e=>{e.exports='from typegraph import TypeGraph, policies, t\nfrom typegraph.runtimes.random import RandomMat, RandomRuntime\n\nwith TypeGraph(\n  "first-typegraph",\n) as g:\n  # declare runtimes and policies\n  random = RandomRuntime()\n  public = policies.public()\n\n  # declare types\n  message = t.struct(\n    {\n      "id": t.integer(),\n      "title": t.string(),\n      "user_id": t.integer(),\n    }\n  )\n\n  # expose them with policies\n  g.expose(\n    # input \u2192 output via materializer\n    get_message=t.func(t.struct(), message, RandomMat(random)),\n    default_policy=[public],\n  )'},3898:e=>{e.exports='t.struct(\n  {\n    "name": t.string().max(200),\n    "age": t.optional(t.integer()),  # or t.integer().optional()\n    "messages": t.array(t.struct({"text": t.string(), "sentAt": t.datetime()})),\n  }\n)\n\n# the typegate will accept data as follow\n{\n  "name": "Alan",\n  "age": 28,\n  "messages": [{"text": "Hello!", "sentAt": "2022-12-28T01:11:10Z"}],\n}\n\n# and reject invalid data\n{"name": "Turing", "messages": [{"sentAt": 1}]}'}}]);